{% extends "dashboard/base_vertical.html" %}
{% block title %}Competitions â€“ Bet Prediction{% endblock %}

{% block content %}
<h1>Competitions</h1>
<p>Countries that have data downloaded (leagues and fixtures).</p>

{% if messages %}
<ul class="messages" style="list-style:none; padding:0;">
  {% for message in messages %}
  <li style="padding:0.5rem 0.75rem; margin-bottom:0.5rem; border-radius:4px;
    {% if message.tags == 'error' %}background:#3d1f1f; color:#f88;{% endif %}
    {% if message.tags == 'success' %}background:#1f3d1f; color:#8f8;{% endif %}
    {% if message.tags == 'warning' %}background:#3d3d1f; color:#cc8;{% endif %}">
    {{ message }}
  </li>
  {% endfor %}
</ul>
{% endif %}

{% if countries_with_data %}
<section style="background:#161b22; padding:1.25rem; border-radius:8px; margin-bottom:1.5rem; border:1px solid #30363d;">
  <h2 style="margin-top:0; font-size:1.1rem;">Sync fixtures for all downloaded leagues</h2>
  <p style="font-size:0.9rem; color:#8b949e;">Re-fetch teams and fixtures for the selected season (uses API requests).</p>
  <form method="post" action="{% url 'api_football:competition_list' %}" style="display:flex; align-items:center; gap:0.75rem; flex-wrap:wrap;">
    {% csrf_token %}
    <input type="hidden" name="action" value="sync_fixtures">
    <label>Season year: <input type="number" name="season_year" value="{{ current_year }}" min="2000" max="2100" style="width:5rem; background:#0d1117; border:1px solid #30363d; color:#e6edf3; padding:0.35rem;"></label>
    <button type="submit">Sync fixtures for all leagues</button>
  </form>
</section>
<ul style="list-style:none; padding:0;">
  {% for row in countries_with_data %}
  <li style="padding:0.75rem 0; border-bottom:1px solid #30363d; display:flex; align-items:center; justify-content:space-between; gap:1rem;">
    <a href="{% url 'api_football:country_detail' row.slug %}" style="font-weight:500; color:#58a6ff; text-decoration:none;">{{ row.country }}</a>
    <span style="font-size:0.9rem; color:#8b949e;">
      {{ row.competition_count }} league{{ row.competition_count|pluralize }}, {{ row.game_count }} game{{ row.game_count|pluralize }}
    </span>
  </li>
  {% endfor %}
</ul>
{% else %}
<p style="color:#8b949e;">No data yet. Use <a href="{% url 'api_football:sync' %}">Sync league data</a> to load countries and download competitions.</p>
{% endif %}
{% endblock %}
